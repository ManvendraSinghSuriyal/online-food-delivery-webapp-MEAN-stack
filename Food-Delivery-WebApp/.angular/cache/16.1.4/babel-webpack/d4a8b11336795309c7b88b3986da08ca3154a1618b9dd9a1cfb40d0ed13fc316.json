{"ast":null,"code":"import { BehaviorSubject, tap } from 'rxjs';\nimport { User } from '../shared/models/User';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class UserService {\n  // @Output() fireIsLoggedIn: EventEmitter<any> = new EventEmitter<any>\n  constructor(http) {\n    this.http = http;\n    this.loginUrl = \"http://localhost:5000/api/users/login\";\n    this.signupUrl = \"http://localhost:5000/api/users/signup\";\n    this.userSubject = new BehaviorSubject(this.getUserFromLocalStorage());\n    this.userObservable = this.userSubject.asObservable();\n  }\n  loginUser(userLogin) {\n    return this.http.post(this.loginUrl, userLogin).pipe(tap({\n      next: user => {\n        alert('login success');\n        this.setUsertoLocalStorage(user);\n        //the reason why login username was not reflecting without refresh was i was not using userSubject.next(user) \n        // so only initializing it with localstorage value wouldn't trigger any change detection or notify subscribers.\n        // so the below code is must to notify change to automatically detect it \n        this.userSubject.next(user);\n        // using event emitter to modify navbar with login user name automatically without refreshing page\n        // this.fireIsLoggedIn.next(user)\n      },\n\n      error: errorResponse => {\n        alert('login failed');\n      }\n    }));\n  }\n  setUsertoLocalStorage(user) {\n    localStorage.setItem('user', JSON.stringify(user));\n  }\n  getUserFromLocalStorage() {\n    const userJson = localStorage.getItem('user');\n    if (userJson) return JSON.parse(userJson);\n    return new User();\n  }\n  logout() {\n    this.userSubject.next(new User());\n    localStorage.removeItem('user');\n    window.location.reload();\n  }\n  // getEmitter() { \n  //   return this.fireIsLoggedIn; \n  // } \n  isLoggedIn() {\n    let tokenStr = localStorage.getItem('user');\n    if (tokenStr == undefined || tokenStr == '' || tokenStr == null) {\n      return false;\n    } else {\n      return true;\n    }\n  }\n  signupUser(user) {\n    return this.http.post(this.signupUrl, user);\n  }\n}\nUserService.ɵfac = function UserService_Factory(t) {\n  return new (t || UserService)(i0.ɵɵinject(i1.HttpClient));\n};\nUserService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: UserService,\n  factory: UserService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"names":["BehaviorSubject","tap","User","UserService","constructor","http","loginUrl","signupUrl","userSubject","getUserFromLocalStorage","userObservable","asObservable","loginUser","userLogin","post","pipe","next","user","alert","setUsertoLocalStorage","error","errorResponse","localStorage","setItem","JSON","stringify","userJson","getItem","parse","logout","removeItem","window","location","reload","isLoggedIn","tokenStr","undefined","signupUser","i0","ɵɵinject","i1","HttpClient","factory","ɵfac","providedIn"],"sources":["D:\\Projects\\Angular Projects\\OnlineFoodDelivery_WebApplication\\Food-Delivery-WebApp\\src\\app\\services\\user.service.ts"],"sourcesContent":["import { HttpClient } from '@angular/common/http';\nimport { EventEmitter, Injectable, Output } from '@angular/core';\nimport { BehaviorSubject, Observable, Subject, tap } from 'rxjs';\nimport { User } from '../shared/models/User';\nimport { UserLogin } from '../shared/interfaces/UserLogin';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class UserService {\n\nloginUrl=\"http://localhost:5000/api/users/login\"\nsignupUrl=\"http://localhost:5000/api/users/signup\"\n\nprivate userSubject=new BehaviorSubject<User>(this.getUserFromLocalStorage());\n// public loginStatusSubject=new Subject<boolean>();\n\npublic userObservable:Observable<User>\n\n// @Output() fireIsLoggedIn: EventEmitter<any> = new EventEmitter<any>\n\n  constructor(private http:HttpClient) {\n\n    this.userObservable=this.userSubject.asObservable()\n   }\n\n\n\n  loginUser(userLogin:UserLogin){\n\n   return this.http.post<User>(this.loginUrl,userLogin).pipe(tap({\n    next:(user)=>{\n      alert('login success')\n      this.setUsertoLocalStorage(user) \n\n      //the reason why login username was not reflecting without refresh was i was not using userSubject.next(user) \n      // so only initializing it with localstorage value wouldn't trigger any change detection or notify subscribers.\n      // so the below code is must to notify change to automatically detect it \n      this.userSubject.next(user)\n\n      // using event emitter to modify navbar with login user name automatically without refreshing page\n      // this.fireIsLoggedIn.next(user)\n      \n    },\n    error:(errorResponse)=>{\n      alert('login failed')\n    }\n   \n  \n    \n   }))\n\n\n  }\n\n  setUsertoLocalStorage(user:User){\n\n\n\n    localStorage.setItem('user',JSON.stringify(user))\n  }\n\n  getUserFromLocalStorage(){\n\n    const userJson= localStorage.getItem('user')\n    if(userJson)\n    return JSON.parse(userJson) as User\n\n    return new User();\n  }\n\n\n  logout(){\n    this.userSubject.next(new User());\n    localStorage.removeItem('user')\n    window.location.reload();\n\n\n  }\n\n  // getEmitter() { \n  //   return this.fireIsLoggedIn; \n  // } \n\n  isLoggedIn(){\n    let tokenStr=localStorage.getItem('user');\n\n    if(tokenStr==undefined || tokenStr==''|| tokenStr==null){\n      return false\n    }\n    else{\n      return true;\n    }\n\n  }\n\nsignupUser(user:User){\n\n  return this.http.post(this.signupUrl,user)\n}\n\n\n\n\n\n}\n"],"mappings":"AAEA,SAASA,eAAe,EAAuBC,GAAG,QAAQ,MAAM;AAChE,SAASC,IAAI,QAAQ,uBAAuB;;;AAM5C,OAAM,MAAOC,WAAW;EAUxB;EAEEC,YAAoBC,IAAe;IAAf,KAAAA,IAAI,GAAJA,IAAI;IAV1B,KAAAC,QAAQ,GAAC,uCAAuC;IAChD,KAAAC,SAAS,GAAC,wCAAwC;IAE1C,KAAAC,WAAW,GAAC,IAAIR,eAAe,CAAO,IAAI,CAACS,uBAAuB,EAAE,CAAC;IASzE,IAAI,CAACC,cAAc,GAAC,IAAI,CAACF,WAAW,CAACG,YAAY,EAAE;EACpD;EAIDC,SAASA,CAACC,SAAmB;IAE5B,OAAO,IAAI,CAACR,IAAI,CAACS,IAAI,CAAO,IAAI,CAACR,QAAQ,EAACO,SAAS,CAAC,CAACE,IAAI,CAACd,GAAG,CAAC;MAC7De,IAAI,EAAEC,IAAI,IAAG;QACXC,KAAK,CAAC,eAAe,CAAC;QACtB,IAAI,CAACC,qBAAqB,CAACF,IAAI,CAAC;QAEhC;QACA;QACA;QACA,IAAI,CAACT,WAAW,CAACQ,IAAI,CAACC,IAAI,CAAC;QAE3B;QACA;MAEF,CAAC;;MACDG,KAAK,EAAEC,aAAa,IAAG;QACrBH,KAAK,CAAC,cAAc,CAAC;MACvB;KAIA,CAAC,CAAC;EAGJ;EAEAC,qBAAqBA,CAACF,IAAS;IAI7BK,YAAY,CAACC,OAAO,CAAC,MAAM,EAACC,IAAI,CAACC,SAAS,CAACR,IAAI,CAAC,CAAC;EACnD;EAEAR,uBAAuBA,CAAA;IAErB,MAAMiB,QAAQ,GAAEJ,YAAY,CAACK,OAAO,CAAC,MAAM,CAAC;IAC5C,IAAGD,QAAQ,EACX,OAAOF,IAAI,CAACI,KAAK,CAACF,QAAQ,CAAS;IAEnC,OAAO,IAAIxB,IAAI,EAAE;EACnB;EAGA2B,MAAMA,CAAA;IACJ,IAAI,CAACrB,WAAW,CAACQ,IAAI,CAAC,IAAId,IAAI,EAAE,CAAC;IACjCoB,YAAY,CAACQ,UAAU,CAAC,MAAM,CAAC;IAC/BC,MAAM,CAACC,QAAQ,CAACC,MAAM,EAAE;EAG1B;EAEA;EACA;EACA;EAEAC,UAAUA,CAAA;IACR,IAAIC,QAAQ,GAACb,YAAY,CAACK,OAAO,CAAC,MAAM,CAAC;IAEzC,IAAGQ,QAAQ,IAAEC,SAAS,IAAID,QAAQ,IAAE,EAAE,IAAGA,QAAQ,IAAE,IAAI,EAAC;MACtD,OAAO,KAAK;KACb,MACG;MACF,OAAO,IAAI;;EAGf;EAEFE,UAAUA,CAACpB,IAAS;IAElB,OAAO,IAAI,CAACZ,IAAI,CAACS,IAAI,CAAC,IAAI,CAACP,SAAS,EAACU,IAAI,CAAC;EAC5C;;AA1Fad,WAAW,C;mBAAXA,WAAW,EAAAmC,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,UAAA;AAAA;AAAXtC,WAAW,C;SAAXA,WAAW;EAAAuC,OAAA,EAAXvC,WAAW,CAAAwC,IAAA;EAAAC,UAAA,EAFV;AAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}